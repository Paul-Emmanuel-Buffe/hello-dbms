<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Observations – Production électrique et CO₂</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&display=swap" rel="stylesheet">

    <!-- CSS commun -->
    <link rel="stylesheet" href="{{ url_for('static', filename='theme.css') }}?v=3">

    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>

<!-- Navbar -->
<nav class="navbar sidebar">
    <div class="navbar-brand">
        CarbonFootprint Project
    </div>

    <ul class="navbar-menu">
        <li>
            <a href="/" title="Présentation du projet">Présentation</a>
        </li>

        <li>
            <a href="/observations" title="Analyses et constats">Observations</a>
        </li>

        <li class="separator"></li>

        <li>
            <a href="/analyse" class="active" title="Simulation CO₂">Calculateur CO₂</a>
        </li>

        <li class="separator"></li>

        <li>
            <a href="/methodologie" title="Sources et hypothèses">Méthodologie</a>
        </li>
    </ul>
</nav>

<!-- Contenu principal -->
<div class="container">

    <h1>Calculateur des émissions de CO₂</h1>
    <p>
        Ce calculateur estime la contribution de chaque source d'énergie aux émissions
        totales de CO₂ pour tous les pays, basé sur les facteurs du GIEC (2014).
    </p>

    <!-- Filtres -->
    <div class="filters">
        <form method="get">
            <label for="country">Choisir un pays / zone géographique :</label>
            <input
                list="countries"
                name="country"
                id="country"
                placeholder="Tapez la première lettre..."
                value="{{ selected_country or '' }}"
            >
            <datalist id="countries">
                {% for c in countries %}
                    <option value="{{ c }}">
                {% endfor %}
            </datalist>
            <button type="submit">Afficher</button>
        </form>
    </div>

    <!-- Graphique -->
        <!-- Card : Répartition des émissions par source -->
    <div class="card">
        <div class="card-header">
            Répartition des émissions de CO₂ par source d’énergie
        </div>
        <div class="card-body">
            <div id="chart-container" style="min-height:320px;"></div>
        </div>
    </div>


    <!-- Card : Aperçu du jeu de données -->
    <div class="card">
        <div class="card-header">
            Émissions de CO₂ par source énergétique
        </div>
        <div class="card-body">

            <!-- Wrapper scrollable OBLIGATOIRE -->
            <div style="max-height: 400px; overflow-y: auto; overflow-x: auto; border: 1px solid #dee2e6; border-radius: 4px;">

                <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                    <thead>
                        <tr style="background-color: #f8f9fa; position: sticky; top: 0; z-index: 10;">
                            {% for column in data[0].keys() %}
                                {% if loop.index == 1 %}
                                    <th style="padding: 10px 16px; text-align: left; white-space: nowrap; font-weight: 600;">
                                        {{ column | replace('_', ' ') | title }}
                                    </th>
                                {% else %}
                                    <th style="padding: 10px 16px; text-align: right; white-space: nowrap; font-weight: 600;">
                                        {{ column | replace('_', ' ') | title }}
                                    </th>
                                {% endif %}
                            {% endfor %}
                        </tr>
                    </thead>

                    <tbody>
                        {% for row in data %}
                            <tr style="border-bottom: 1px solid #dee2e6;">
                                {% for key, value in row.items() %}
                                    {% if loop.index == 1 %}
                                        <td style="padding: 10px 16px; white-space: nowrap; font-weight: 600;">
                                            {{ value }}
                                        </td>
                                    {% else %}
                                        <td style="padding: 10px 16px; text-align: right;">
                                            {% if value is number %}
                                                {{ "%.1f"|format(value) }}
                                            {% else %}
                                                {{ value }}
                                            {% endif %}
                                        </td>
                                    {% endif %}
                                {% endfor %}
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>

            </div>
        </div>
    </div>

</div>

<!-- Script Plotly -->
<script>
    {% if graph %}
        var graphData = {{ graph | safe }};
        Plotly.newPlot(
            'chart-container',
            graphData.data,
            graphData.layout,
            { responsive: true }
        );
    {% else %}
        document.getElementById('chart-container').innerHTML =
            '<p style="text-align:center; color:#666;">Aucune donnée à afficher</p>';
    {% endif %}
</script>


</body>
</html>
